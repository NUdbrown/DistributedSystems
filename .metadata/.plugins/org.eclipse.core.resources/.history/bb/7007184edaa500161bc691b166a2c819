import java.io.IOException;
import java.io.InputStream;
import java.io.ObjectInputStream;
import java.io.PrintWriter;
import java.net.ServerSocket;
import java.net.Socket;
import java.net.SocketException;
import java.util.ArrayList;
import java.util.HashMap;
import java.util.Random;

import com.hallaLib.HallaStor;

public class Server implements Runnable {

	private Random random = new Random();
	
	public static void main(String[] args) {
		Server s = new Server();
		s.run();
	}

	public void run() {
		HashMap<CrudOperations, Object> request = null;

		try {
			ServerSocket ss = new ServerSocket(3000);
			String command = null;
			System.out.println("server created");
			while (!ss.isClosed()) { 
				Socket clientSocket = ss.accept();
				System.out.println("ive accepted");
				
				ObjectInputStream ois = new ObjectInputStream(clientSocket.getInputStream());
				request = (HashMap) ois.readObject();
				System.out.println("I accepted the object");
				
				
				switch (command.toUpperCase()) {
				case "update":
					getStore().update(key, currentObj);
					break;
				case "add":
					if(request.get(CrudOperations.ADD) instanceof Driver){					
						System.out.println();
					}else{
						System.out.println();
					}
					key = generateKey(object);
					getStore().add(key, currentObj);
					break;
				case "delete":					
					getStore().delete(key);
					break;
				case "exit":
					ss.close();
					break;

				}
				
			}
			
			
		}catch(SocketException e){
			System.out.println("socket probably finished and closed - server side");
			e.printStackTrace();
		}
		catch (IOException | ClassNotFoundException e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
		
	}

	public HallaStor getStore() {
		return HallaStor.getInstance();
	}

	public String generateKey(Object object) {

		return null;
	}
}
